---
number: "4"
title: "Promise"
type: "labs"
---

# Promise

**Цель:** получить представление об асинхронности и цикле событий (Event Loop), научиться пользоваться функциями обратного вызова, объектом Promise и его методами.

## Теория для изучения

1. Замыкания и принцип их работы.
1. Асинхронность, цикл событий (Event Loop), функции обратного вызова.
1. Таймеры: setTimeout, setInterval, clearInterval.
1. Объект Promise и его методы.

## Источники

- [Область видимости переменных, замыкание](https://learn.javascript.ru/closure)
- [Планирование: setTimeout и setInterval](https://learn.javascript.ru/settimeout-setinterval)
- [Асинхронное программирование в однопоточных средах JavaScript](https://habr.com/ru/articles/651037/)
- [Асинхронность](https://doka.guide/js/async-in-js/)
- [MDN: Асинхронность](https://developer.mozilla.org/ru/docs/Learn/JavaScript/Asynchronous)
- [Функции обратного вызова](https://learn.javascript.ru/callbacks)
- [Демо Event Loop](http://latentflip.com/loupe/)
- [Запись выступления про Event Loop](https://www.youtube.com/watch?v=8aGhZQkoFbQ)
- [Промисы](https://doka.guide/js/promise/)
- [Использование промисов](https://developer.mozilla.org/ru/docs/Web/JavaScript/Guide/Using_promises)
- [Объект Promise и его методы: then, catch, finally](https://learn.javascript.ru/promise-basics)
- [Ад обратного вызова](http://callbackhell.com/)

## Практическая часть

1. Переключите на ветку main.
1. Убедитесь, что все настройки инструментов и необходимые зависимости есть. Если нет, то вернитесь к прошлым работам и настройте.
1. Создайте ветку lab4 и работайте на ней.
1. Создайте документ html с H1 заголовком «ФИО - Лабораторная работа №4».
1. Решите предложенные задачи используя JS и подключите решения к созданной странице. Элементы интерфейса для задач разместить в отдельных секциях с соответствующими подзаголовками.
1. Проведите ручное тестирование в браузере.
1. Отформатируйте документы.
1. Убедитесь, что нет замечаний от ESLint.
1. Зафиксируйте результаты работы с помощью системы контроля версий git и отправьте ветку lab3 в репозиторий на github.
1. Загрузите проект на Render через ручную загрузку (manual deploy).

### Требования к решению

- HTML код валиден.
- Отсутствуют ошибки ESLint.
- Отсутствуют ошибки в консоли браузера при работе с веб-страницей.

## Результаты выполнения лабораторной работы

Результаты работы _проверены наставником_.

Статическая веб-страница на хостинге, со структурой и оформлением, которая соответствует требованиям и сохранена в системе контроля версий.

## Задачи

### Resolve

В интерфейсе добавить кнопку, при нажатии на которую вызывается функция job. Эта функция возвращает объект promise. Promise должен разрешиться через 2 секунды после вызова функции job и представляет строку "работа сделана" в данных, и эта же строка отображается в виде текста в интерфейсе под кнопкой.

### Случайные данные и ошибки

Напишите функцию getData, которая в качестве аргумента принимает вероятность появления ошибки (значение по умолчанию 0.5) и строку с данными, в локальной области видимости к переданной строке в начало добавляет "Синтетические данные: ", а возвращает функцию.
Возвращаемая функция в качестве аргумента принимает число, проверяет что аргумент является числом (не забыть про NaN) и с указанной долей вероятности возвращает либо данные, либо null.

### Крафт

Вы создаете простую систему крафта, в которой пользователи могут создавать виртуальные предметы. Для создания каждого предмета есть определенное время, и может потребоваться сначала создать другие предметы.

Пример базовой системы крафта:

- Чтобы изготовить кирку, вам понадобится палка и железный слиток.
- Чтобы изготовить палку, вам понадобится дерево.
- Чтобы изготовить железный слиток, вам понадобится железная руда.

Процесс изготовления асинхронен, то есть для изготовления каждого предмета требуется некоторое время. Вам надо использовать Promise, чтобы справиться с этими задержками и зависимостями.

Возможные структуры данных:

- Объект inventory для хранения доступных предметов
- Объект для хранения данных о предмете включая: name (название предмета), craftingTime (время в миллисекундах, необходимое для создания предмета), requiredItems (массив предметов, необходимых для создания этого предмета; может быть пустым, если предметы не требуются), failProbability (число от 0 до 1, обозначающее вероятность провала создания; вероятность проверяется по истечении таймера).

Создайте простой HTML-интерфейс:

- Кнопки для каждого предмета, который можно изготовить с количеством готового.
- Индикатор создания для каждого предмета.
- Область вывода для отображения прогресса и результатов создаваемого предмета (например, "Создание...", "Успех", "Неудача").

Общий сценарий:

- Пользователь нажимает кнопку (например, "Создать кирку").
- Система проверяет, доступны ли необходимые дополнительные предметы (например, палка, железный слиток).
- Если дополнительные предметы необходимы:
  - Система начинает создавать их асинхронно.
  - Пользовательский интерфейс обновляется, чтобы показать статус каждого предмета.
- Как только все элементы будут готовы, система начнет создавать основной элемент. Если какой-либо из них не будет создан, то созданные предметы сохраняются в инвентаре, а выполнение основного предмета завершается с ошибкой.
- Интерфейс показывает прогресс и результат для всех предметов.

Выводите прогресс и результаты всех предметов, даже если создание некоторых из них завершилось неудачей. Подумайте, стоит ли блокировать работу кнопок на время изготовления предметов.

## Вопросы для защиты

1. Стек вызова (call stack).
1. Функции обратного вызова (callbacks).
1. Таймеры в JS. Создание и удаление.
1. Замыкание и примеры применения.
1. Асинхронное программирование в JS.
1. Общий принцип работы event loop.
1. Объект Promise и его состояния.
1. Методы объекта promise. Примеры их использования.
